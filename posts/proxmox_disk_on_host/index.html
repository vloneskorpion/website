<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>How to access proxmox disk image file on host? - knowak.dev</title>
<meta name=description content="A DevOps, Linux, and Programming Journal"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><link rel=stylesheet href=/css/bundle.min.441e898271d60980fe7c49a2d2b9c334024c6cf4fd06d9cce5ffb7663d08924ac948ef2dca1e42fb2110f4d5a9122c0e3e6b6fa446f28792e04a9b6bc147e26d.css integrity="sha512-RB6JgnHWCYD+fEmi0rnDNAJMbPT9BtnM5f+3Zj0IkkrJSO8tyh5C+yEQ9NWpEiwOPmtvpEbyh5LgSptrwUfibQ=="><link rel=stylesheet href=/css/emergency-list-fix.css><link rel=icon type=image/png href=/images/favicon.png><style>.post{background:var(--card-background);border:1px solid var(--card-border);border-radius:5px;margin-bottom:2rem;padding:2rem}.post-header{margin-bottom:2rem;text-align:center}.post-title{color:var(--neon-cyan);font-size:2.5rem;margin:0 0 1rem}.post-content{font-size:1.1rem;line-height:1.8}.post-content img{border:1px solid var(--neon-cyan);border-radius:5px;display:block;max-width:100%;margin:2rem auto}.post-navigation{display:flex;justify-content:space-between;margin-top:3rem}.prev-post,.next-post{background:var(--card-background);border:1px solid var(--card-border);border-radius:3px;color:var(--light-text);display:inline-block;max-width:45%;padding:.5rem 1rem;text-decoration:none;transition:border-color .3s ease,box-shadow .3s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.prev-post:hover,.next-post:hover{border-color:var(--neon-cyan);box-shadow:0 0 10px rgba(14,255,255,.3)}#TableOfContents{font-size:.9rem}#TableOfContents ul{list-style-type:none;padding-left:1rem}#TableOfContents>ul{padding-left:0}#TableOfContents a{color:var(--neon-cyan);display:inline-block;margin:.25rem 0;text-decoration:none;transition:color .3s ease}#TableOfContents a:hover{color:var(--neon-pink)}.highlight{border-radius:5px;margin:1.5rem 0;position:relative}</style></head><body><div class=container><header><h1 class=site-title><a href=/>knowak.dev</a></h1><p class=site-description>A DevOps, Linux, and Programming Journal</p><nav><ul><li><a href=/>Home</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=/archive/>Archive</a></li></ul></nav></header><main><article class=post><header class=post-header><h1 class=post-title>How to access proxmox disk image file on host?</h1><div class=post-meta><span><i class="far fa-calendar-alt"></i> November 5, 2024</span>
<span><i class="far fa-clock"></i> 2 min read</span></div></header><div class=post-content><p>Recently I could not connect to my proxmox virtual machine on which I had some important files for my project. In this tutorial I will show how to easily mount a disk from a proxmox virtual machine and access its data.</p><ol><li>Find your .qcow2 disk image file which you would like to mount. They are located usually under <code>/var/lib/vz/images</code> folder.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ls /var/lib/vz/images/*
</span></span><span style=display:flex><span>/var/lib/vz/images/100:
</span></span><span style=display:flex><span>vm-100-disk-0.qcow2  vm-100-disk-1.qcow2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/var/lib/vz/images/101:
</span></span><span style=display:flex><span>vm-101-disk-0.qcow2  vm-101-disk-1.qcow2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/var/lib/vz/images/106:
</span></span><span style=display:flex><span>vm-106-disk-0.qcow2  vm-106-disk-1.qcow2&gt;<span style=color:#f92672>)</span>
</span></span></code></pre></div><ol start=2><li>Ensure that nbd module is loaded into kernel.</li></ol><p>The nbd kernel module stands for Network Block Device. It allows you to treat a file like a .qcow2 disk image as if it was a local disk represented by block devices like <code>/dev/nbd*</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo modprobe nbd max_part<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>
</span></span></code></pre></div><ol start=3><li>Use qemu-nbd to attach the .qcow2 disk image to an NBD device.</li></ol><p>qemu-nbd is a tool from the <strong>QEMU</strong> suite that allows disk images (such as .qcow2 files) to be attached to the host’s NBD system, making them accessible as block devices like in this example <code>/dev/nbd0</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>qemu-nbd --connect<span style=color:#f92672>=</span>/dev/nbd0 /var/lib/vz/images/100/vm-100-disk-0.qcow2
</span></span></code></pre></div><ol start=4><li>Identify partitions on the disk.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>fdisk -l /dev/nbd0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device         Start      End  Sectors  Size Type
</span></span><span style=display:flex><span>/dev/nbd0p1     <span style=color:#ae81ff>2048</span>  <span style=color:#ae81ff>1050623</span>  <span style=color:#ae81ff>1048576</span>  512M EFI System
</span></span><span style=display:flex><span>/dev/nbd0p2  <span style=color:#ae81ff>1050624</span> <span style=color:#ae81ff>65107967</span> <span style=color:#ae81ff>64057344</span> 30.5G Linux filesystem
</span></span><span style=display:flex><span>/dev/nbd0p3 <span style=color:#ae81ff>65107968</span> <span style=color:#ae81ff>67106815</span>  <span style=color:#ae81ff>1998848</span>  976M Linux swap
</span></span></code></pre></div><ol start=5><li>Mount the partition in which you are interested in. In my case it was <code>/dev/nbd0p2</code>.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /mnt/data
</span></span><span style=display:flex><span>mount /dev/nbd0p2 /mnt/data
</span></span></code></pre></div><ol start=6><li>You can now navigate to <code>/mnt/data</code> to access the files on the .qcow2 disk.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /mnt/data
</span></span></code></pre></div><ol start=7><li>After accessing the data, unmount the partition and disconnect the NBD device.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>umount /mnt/data
</span></span><span style=display:flex><span>qemu-nbd --disconnect /dev/nbd0
</span></span></code></pre></div><p>That&rsquo;s all! As you see it&rsquo;s so easy to access .qcow2 disk images from a host. Hope that helped you!</p></div><div class=post-tags><a href=/tags/devops class=tag>devops</a>
<a href=/tags/linux class=tag>linux</a>
<a href=/tags/proxmox class=tag>proxmox</a></div><div class=post-navigation><a href=/posts/bash_special_parameters/ class=prev-post><i class="fas fa-chevron-left"></i> Special Parameters in Bash
</a><a href=/posts/lxc_containers_overview_on_debian_host/ class=next-post>LXC containers overview on Debian host <i class="fas fa-chevron-right"></i></a></div></article></main><footer><div class=social-links><a href=https://github.com/vloneskorpion class=social-link target=_blank rel="noopener noreferrer"><i class="fab fa-github"></i>
</a><a href=https://www.linkedin.com/in/kamilnowak432 class=social-link target=_blank rel="noopener noreferrer"><i class="fab fa-linkedin"></i></a></div><p class=copyright>© 2025 knowak.dev</p></footer></div><script src=/js/main.min.34d8dddb9e55be0a91d431e37847b8f08f179e8c132b106481efeb0337bd55ead688e9e7559444f1c7e5db67682e335d1ac7316e12538663159f704b068cecdf.js integrity="sha512-NNjd255VvgqR1DHjeEe48I8XnowTKxBkge/rAze9VerWiOnnVZRE8cfl22doLjNdGscxbhJThmMVn3BLBozs3w=="></script></body></html>